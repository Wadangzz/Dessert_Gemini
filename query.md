ALTER TABLE public.employees ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow admins to see all employees" ON public.employees FOR SELECT USING(public.get_my_role() = '관리자');

ALTER TABLE public.inventory ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow all users to view inventory" ON public.inventory FOR SELECT USING (auth.role() ='authenticated');

CREATE POLICY "Allow admins to modify inventory" ON public.inventory FOR ALL USING (public.get_my_role() = '관리자');

ALTER TABLE public.purchase_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow users to insert their own purchases" ON public.purchase_logs FOR INSERT WITH CHECK(employee_id = split_part(auth.jwt()->>'email', '@', 1));
CREATE POLICY "Allow users to view their own purchases" ON public.purchase_logs FOR SELECT USING(employee_id = split_part(auth.jwt()->>'email', '@', 1));
CREATE POLICY "Allow admins to see all purchase logs" ON public.purchase_logs FOR SELECT USING(public.get_my_role() = '관리자');

ALTER TABLE public.purchase_logs
  ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY;